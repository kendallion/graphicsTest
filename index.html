<html>
    <head>
        <title>Isometric Test</title>
        <link rel="stylesheet" href="style.css" />
    </head>

    <body>
        <p id="temp"></p>

        <canvas id="myCanvas" width="1664" height="960"></canvas>
        <button id="addHouse" onclick="addHouse()">Add House</button>
    </body>

    <script>
        var imgHouse = new Image();
        var imgHorizontalRoad = new Image();
        var imgVerticalRoad = new Image();
        var imgTopRightRoad = new Image();
        var imgBottomRightRoad = new Image();
        var imgTopLeftRoad = new Image();
        var imgBottomLeftRoad = new Image();
        imgHouse.src = "assets/house2.png";
        imgHorizontalRoad.src = "assets/roads/horizontalRoad.png"; //1
        imgVerticalRoad.src = "assets/roads/verticalRoad.png"; //2
        imgTopRightRoad.src = "assets/roads/topRight.png"; //3
        imgBottomRightRoad.src = "assets/roads/bottomRight.png"; //4
        imgTopLeftRoad.src = "assets/roads/topLeft.png"; //5
        imgBottomLeftRoad.src = "assets/roads/bottomLeft.png"; //6

        var map = [
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],
            [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]
        ];

        var c = document.getElementById("myCanvas");
        var ctx = c.getContext("2d");

        var availableRoadTiles = [];
        //STRUCTURE: [x, y, entryPoint]
        //ENTRY POINT:
            //0: from the top (of this tile)
            //1: from the right
            //2: from the bottom
            //3: from the left

        imgBottomLeftRoad.onload = function(){
            //ctx.drawImage(imgHorizontalRoad, 256, 256);
            availableRoadTiles.push([7,5,1]);
            availableRoadTiles.push([9,5,3]);
            renderMap();
        };

        function addRoad(){
            if(!availableRoadTiles.length) return;
            var tile = availableRoadTiles[Math.floor(Math.random() * availableRoadTiles.length)];
            var roadRand = Math.ceil(Math.random() * 4);
            var roadType;

            if(tile[2] == 0) { //4, 2, 6
                if(roadRand == 1) roadType = 4;
                else if(roadRand == 2) roadType = 6;
                else roadType = 2;
            }
            else if(tile[2] == 1) { //1, 5, 6
                if(roadRand == 1) roadType = 5;
                else if(roadRand == 2) roadType = 6;
                else roadType = 1;
            }
            else if(tile[2] == 2) { //3, 5, 2
                if(roadRand == 1) roadType = 3;
                else if(roadRand == 2) roadType = 5;
                else roadType = 2;
            }
            else if(tile[2] == 3) { //1, 3, 4
                if(roadRand == 1) roadType = 3;
                else if(roadRand == 2) roadType = 4;
                else roadType = 1;
            }

            map[tile[1]][tile[0]] = roadType;
            renderMap();
            var index = availableRoadTiles.indexOf(tile);
            availableRoadTiles.splice(index, 1);
            var nextTile;
            if(roadType == 1) {
                if(map[tile[1]][tile[0]-1] == 0) nextTile = ([tile[0]-1,tile[1],1]);
                else if(map[tile[1]][tile[0]+1] == 0) nextTile = ([tile[0]+1,tile[1],3]);
            }
            if(roadType == 2) {
                if(map[tile[1]-1][tile[0]] == 0) nextTile = ([tile[0],tile[1]-1,2]);
                else if(map[tile[1]+1][tile[0]] == 0) nextTile = ([tile[0],tile[1]+1,0]);
            }
            if(roadType == 3) {
                if(map[tile[1]][tile[0]-1] == 0) nextTile = ([tile[0]-1,tile[1],1]);
                else if(map[tile[1]+1][tile[0]] == 0) nextTile = ([tile[0],tile[1]+1,0]);
            }
            if(roadType == 4) {
                if(map[tile[1]][tile[0]-1] == 0) nextTile = ([tile[0]-1,tile[1],1]);
                else if(map[tile[1]-1][tile[0]] == 0) nextTile = ([tile[0],tile[1]-1,2]);
            }
            if(roadType == 5) {
                if(map[tile[1]][tile[0]+1] == 0) nextTile = ([tile[0]+1,tile[1],3]);
                else if(map[tile[1]+1][tile[0]] == 0) nextTile = ([tile[0],tile[1]+1,0]);
            }
            if(roadType == 6) {
                if(map[tile[1]][tile[0]+1] == 0) nextTile = ([tile[0]+1,tile[1],3]);
                else if(map[tile[1]-1][tile[0]] == 0) nextTile = ([tile[0],tile[1]-1,2]);
            }
            if(nextTile != null && (nextTile[0] < 0 || nextTile[1] < 0)) return;
            if(nextTile) availableRoadTiles.push(nextTile);
        }

        function renderMap(){
            ctx.clearRect(0,0,1664,960);
            var bw = 1664;
            // Box height
            var bh = 960;
            function drawBoard(){
                ctx.lineWidth = 2;
                ctx.strokeStyle = "rgb(0,0,0)";
                for (var x = 0; x < bw; x += 64) {
                    for (var y = 0; y < bh; y += 64) {
                       ctx.strokeRect(x, y, 64, 64);
                    }
                }
            }
        drawBoard();
            for(var x=0;x<map[0].length;x++){
                for(var y=0;y<map.length;y++){
                    if(map[y][x] == 1) ctx.drawImage(imgHorizontalRoad, x*64, y*64);
                    else if(map[y][x] == 2) ctx.drawImage(imgVerticalRoad, x*64, y*64);
                    else if(map[y][x] == 3) ctx.drawImage(imgTopRightRoad, x*64, y*64);
                    else if(map[y][x] == 4) ctx.drawImage(imgBottomRightRoad, x*64, y*64);
                    else if(map[y][x] == 5) ctx.drawImage(imgTopLeftRoad, x*64, y*64);
                    else if(map[y][x] == 6) ctx.drawImage(imgBottomLeftRoad, x*64, y*64);
                    else if(map[y][x] == 7) ctx.drawImage(imgHouse, x*64, y*64);
                }
            }
        };

        function addHouse(){
            var x = Math.floor(Math.random() * 25); //column number
            var y = Math.floor(Math.random() * 14); //row number
            console.log(x + ", " + y);
            if(map[y][x] != 0) {
                addHouse();
                return;
            }
            else map[y][x] = 7;
            renderMap();
        }
        setInterval(function(){addRoad()}, 10);
    </script>
</html>

<!--
    for(var i=1;i<=100;i++) {
        document.getElementById('temp').innerText += "\t<td id=\"td" + i + "\"></td>\r\n";
        if(i%10==0) document.getElementById('temp').innerText += "</tr>\r\n<tr>\r\n";
    }
-->
